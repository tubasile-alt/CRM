OBJETIVO:
No prontu√°rio de Transplante Capilar, a aba ‚ÄúPlanejamento Cir√∫rgico‚Äù deve:
1) SALVAR os dados corretamente no banco quando o atendimento √© finalizado/salvo.
2) APARECER na ‚ÄúEvolu√ß√£o Cl√≠nica / Hist√≥rico de Consultas‚Äù em uma √°rea pr√≥pria, mas SOMENTE para casos de Transplante Capilar (ou quando o procedimento/consulta for ‚ÄúTransplante Capilar‚Äù).

REQUISITOS:
- N√£o quebrar outras consultas (botox, retorno etc).
- Nada de mostrar o bloco em consultas n√£o relacionadas a transplante.
- Se n√£o houver planejamento preenchido, n√£o mostrar.
- Mostrar no bloco de evolu√ß√£o: Indica√ß√£o, Norwood, Tipo de caso, √°reas, indica√ß√µes cir√∫rgicas, texto livre de planejamento e anexos (se existirem).

========================================
PASSO 1 ‚Äî Diagn√≥stico: verificar se est√° sendo enviado e salvo
========================================
1) Localize o endpoint que salva/finaliza a consulta do prontu√°rio (onde o bot√£o ‚ÄúFinalizar Atendimento‚Äù envia dados).
   - Use busca no repo por:
     - "Finalizar Atendimento"
     - "/finalizar"
     - "save_consult"
     - "consultation"
     - "planning"
     - ids dos inputs do print: "norwood", "planejamento", "Transplante Capilar", etc.
2) Confirme se os campos da aba Planejamento Cir√∫rgico est√£o no payload do POST/PUT.
   - Se n√£o estiverem, corrigir o front para incluir.
3) Confirme que o backend est√° gravando e commitando.

========================================
PASSO 2 ‚Äî Persist√™ncia: criar campos no Model da consulta
========================================
No model de consulta (ex.: Consultation/AppointmentNote/MedicalRecord ‚Äî use o que representa ‚Äúconsulta‚Äù no prontu√°rio):
- Adicionar campos:
  - hair_tx_plan_json = db.Column(db.JSON, nullable=True)  # ou Text se JSON n√£o estiver dispon√≠vel
  - hair_tx_indication = db.Column(db.Boolean, default=False)
  - hair_tx_norwood = db.Column(db.Integer, nullable=True)

Se seu banco for Postgres (Neon), JSON √© ok.
Se estiver usando SQLite em dev, JSON do SQLAlchemy tamb√©m funciona, ou use Text com json.dumps.

Atualizar create_all/migrations conforme o projeto:
- Se n√£o usa Alembic, garantir que existe caminho de migra√ß√£o manual (ou instru√ß√µes).

========================================
PASSO 3 ‚Äî Frontend: coletar e enviar dados do Planejamento Cir√∫rgico
========================================
No arquivo JS do prontu√°rio (o que envia o payload da consulta):
- Coletar os campos do Planejamento Cir√∫rgico:
  - Indica√ß√£o de transplante (Sim/N√£o)
  - J√° fez transplante antes (Sim/N√£o)
  - Norwood selecionado (1-6)
  - Tipo de caso: Prim√°ria/Secund√°ria
  - Checkboxes: ‚ÄúUma √∫nica cirurgia‚Äù, ‚ÄúDuas cirurgias‚Äù, ‚ÄúBody hair transplant‚Äù
  - Checkboxes de √°reas: sobrancelha/barba/feminino etc (se existirem)
  - Indica√ß√µes cir√∫rgicas (frontal/coroa/completo/body hair/dense packing)
  - Texto livre de planejamento (textarea)
  - Anexos (se s√£o upload: garantir que backend j√° salva e guarda caminho/URL)
- Montar um objeto:
  const hairTxPlan = { ...campos... }
- Inserir isso no payload principal da consulta como:
  hair_tx_plan: hairTxPlan
  hair_tx_indication: true/false
  hair_tx_norwood: number|null

Se seu envio √© multipart/form-data por causa dos anexos:
- enviar hair_tx_plan como JSON.stringify(hairTxPlan)

========================================
PASSO 4 ‚Äî Backend: salvar no banco no final da consulta
========================================
No endpoint que salva/finaliza consulta:
- Ler hair_tx_plan do request (json ou string)
- Se procedimento/consulta for ‚ÄúTransplante Capilar‚Äù OU se houver qualquer campo de hair_tx_plan preenchido:
  - consultation.hair_tx_plan_json = parsedPlan
  - consultation.hair_tx_indication = parsedPlan.indicacao === true
  - consultation.hair_tx_norwood = parsedPlan.norwood (int)
- Caso contr√°rio, n√£o mexer nesses campos (ou limpar se preferir, mas n√£o √© obrigat√≥rio)
- Garantir db.session.commit()

========================================
PASSO 5 ‚Äî Evolu√ß√£o cl√≠nica: exibir bloco de Planejamento Cir√∫rgico
========================================
No template/HTML da ‚ÄúEvolu√ß√£o Cl√≠nica / Hist√≥rico de Consultas‚Äù:
- Criar uma se√ß√£o:
  ‚Äúü©∫ Planejamento Cir√∫rgico (Transplante Capilar)‚Äù
- Mostrar SOMENTE se:
  - consultation.hair_tx_plan_json existe (n√£o vazio)
  E
  - (consulta/procedimento == ‚ÄúTransplante Capilar‚Äù OU hair_tx_indication == true OU hair_tx_norwood n√£o √© null)

Conte√∫do do bloco:
- Indica√ß√£o: Sim/N√£o
- Norwood: X
- Tipo de caso: Prim√°ria/Secund√°ria
- √Åreas/Indica√ß√µes marcadas: listar como chips/badges
- Texto do planejamento (quebra de linha preservada)
- Links/nomes dos anexos (se houver paths)

========================================
PASSO 6 ‚Äî Crit√©rios de aceite (teste em 2 minutos)
========================================
1) Abrir uma consulta de Transplante Capilar
2) Preencher Planejamento Cir√∫rgico (Norwood + texto + 2 checkboxes)
3) Finalizar/salvar atendimento
4) Reabrir a consulta: dados devem estar preenchidos
5) Ir no Hist√≥rico/Evolu√ß√£o cl√≠nica: o bloco ‚ÄúPlanejamento Cir√∫rgico‚Äù deve aparecer com os dados
6) Abrir uma consulta de Botox: N√ÉO pode aparecer o bloco

ENTREGA:
- Lista de arquivos alterados
- Trechos principais do c√≥digo adicionados (model, endpoint, template, JS)
- Passos curtos de como testar